import{r as d,j as V}from"./react-C7j5qwjx.js";import{L as Oe,T as $e,R as Xt,U as Yt,a as Zt,O as qe,P as Ve,S as nt,b as Re,N as Kt,A as Jt,B as Qt,M as en,C as tn,V as q,c as gt,W as nn,d as rn,e as on,f as sn,g as an,h as ln,i as cn,D as un,j as Ee,k as Xe,l as fn,m as dn,E as yt,n as pn,o as mn,p as vn,q as ue,r as hn,s as gn,t as yn}from"./three-BFxAWP9U.js";import{c as rt}from"./debounce-T2e3Kadd.js";import{F as bn,u as wn}from"./its-fine-BxhlTFfY.js";import{R as En,c as ce}from"./react-reconciler-BlyokjeE.js";import{_ as J}from"./@babel-CF3RwP-h.js";import{c as _n}from"./react-dom-D3Ykk5PJ.js";import{c as bt}from"./zustand-BYCiPB6a.js";import"./maath-DzwSeTd1.js";import{D as Pn,G as Ye,a as Cn,M as je,O as Mn}from"./three-stdlib-C3lkyCdR.js";import{s as xn,p as Sn,c as On}from"./suspend-react-BKIKQNXN.js";function Tr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ar(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var l=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,l.get?l:{enumerable:!0,get:function(){return e[i]}})}),n}var wt={exports:{}},Et={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,x){var C=b.length;b.push(x);e:for(;0<C;){var O=C-1>>>1,k=b[O];if(0<l(k,x))b[O]=x,b[C]=k,C=O;else break e}}function n(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var x=b[0],C=b.pop();if(C!==x){b[0]=C;e:for(var O=0,k=b.length,A=k>>>1;O<A;){var B=2*(O+1)-1,N=b[B],Y=B+1,oe=b[Y];if(0>l(N,C))Y<k&&0>l(oe,N)?(b[O]=oe,b[Y]=C,O=Y):(b[O]=N,b[B]=C,O=B);else if(Y<k&&0>l(oe,C))b[O]=oe,b[Y]=C,O=Y;else break e}}return x}function l(b,x){var C=b.sortIndex-x.sortIndex;return C!==0?C:b.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var p=Date,f=p.now();e.unstable_now=function(){return p.now()-f}}var c=[],m=[],r=1,o=null,a=3,v=!1,h=!1,w=!1,y=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function P(b){for(var x=n(m);x!==null;){if(x.callback===null)i(m);else if(x.startTime<=b)i(m),x.sortIndex=x.expirationTime,t(c,x);else break;x=n(m)}}function R(b){if(w=!1,P(b),!h)if(n(c)!==null)h=!0,$(M);else{var x=n(m);x!==null&&H(R,x.startTime-b)}}function M(b,x){h=!1,w&&(w=!1,u(L),L=-1),v=!0;var C=a;try{for(P(x),o=n(c);o!==null&&(!(o.expirationTime>x)||b&&!E());){var O=o.callback;if(typeof O=="function"){o.callback=null,a=o.priorityLevel;var k=O(o.expirationTime<=x);x=e.unstable_now(),typeof k=="function"?o.callback=k:o===n(c)&&i(c),P(x)}else i(c);o=n(c)}if(o!==null)var A=!0;else{var B=n(m);B!==null&&H(R,B.startTime-x),A=!1}return A}finally{o=null,a=C,v=!1}}var _=!1,j=null,L=-1,S=5,T=-1;function E(){return!(e.unstable_now()-T<S)}function D(){if(j!==null){var b=e.unstable_now();T=b;var x=!0;try{x=j(!0,b)}finally{x?W():(_=!1,j=null)}}else _=!1}var W;if(typeof g=="function")W=function(){g(D)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,I=X.port2;X.port1.onmessage=D,W=function(){I.postMessage(null)}}else W=function(){y(D,0)};function $(b){j=b,_||(_=!0,W())}function H(b,x){L=y(function(){b(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){h||v||(h=!0,$(M))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(b){switch(a){case 1:case 2:case 3:var x=3;break;default:x=a}var C=a;a=x;try{return b()}finally{a=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,x){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var C=a;a=b;try{return x()}finally{a=C}},e.unstable_scheduleCallback=function(b,x,C){var O=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?O+C:O):C=O,b){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=C+k,b={id:r++,callback:x,priorityLevel:b,startTime:C,expirationTime:k,sortIndex:-1},C>O?(b.sortIndex=C,t(m,b),n(c)===null&&b===n(m)&&(w?(u(L),L=-1):w=!0,H(R,C-O))):(b.sortIndex=k,t(c,b),h||v||(h=!0,$(M))),b},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(b){var x=a;return function(){var C=a;a=x;try{return b.apply(this,arguments)}finally{a=C}}}})(Et);wt.exports=Et;var ot=wt.exports;const Ze={},Rn=e=>void Object.assign(Ze,e);function jn(e,t){function n(r,{args:o=[],attach:a,...v},h){let w=`${r[0].toUpperCase()}${r.slice(1)}`,y;if(r==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const u=v.object;y=ae(u,{type:r,root:h,attach:a,primitive:!0})}else{const u=Ze[w];if(!u)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=ae(new u(...o),{type:r,root:h,attach:a,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof Qt?y.__r3f.attach="geometry":y instanceof en&&(y.__r3f.attach="material")),w!=="inject"&&Le(y,v),y}function i(r,o){let a=!1;if(o){var v,h;(v=o.__r3f)!=null&&v.attach?Ae(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),a=!0),a||(h=r.__r3f)==null||h.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=r,Ue(o),le(o)}}function l(r,o,a){let v=!1;if(o){var h,w;if((h=o.__r3f)!=null&&h.attach)Ae(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:o});const y=r.children.filter(g=>g!==o),u=y.indexOf(a);r.children=[...y.slice(0,u),o,...y.slice(u)],v=!0}v||(w=r.__r3f)==null||w.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=r,Ue(o),le(o)}}function s(r,o,a=!1){r&&[...r].forEach(v=>p(o,v,a))}function p(r,o,a){if(o){var v,h,w;if(o.__r3f&&(o.__r3f.parent=null),(v=r.__r3f)!=null&&v.objects&&(r.__r3f.objects=r.__r3f.objects.filter(R=>R!==o)),(h=o.__r3f)!=null&&h.attach)ct(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var y;r.remove(o),(y=o.__r3f)!=null&&y.root&&Hn(Me(o),o)}const g=(w=o.__r3f)==null?void 0:w.primitive,P=!g&&(a===void 0?o.dispose!==null:a);if(!g){var u;s((u=o.__r3f)==null?void 0:u.objects,o,P),s(o.children,o,P)}if(delete o.__r3f,P&&o.dispose&&o.type!=="Scene"){const R=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?ot.unstable_scheduleCallback(ot.unstable_IdlePriority,R):R()}le(r)}}function f(r,o,a,v){var h;const w=(h=r.__r3f)==null?void 0:h.parent;if(!w)return;const y=n(o,a,r.__r3f.root);if(r.children){for(const u of r.children)u.__r3f&&i(y,u);r.children=r.children.filter(u=>!u.__r3f)}r.__r3f.objects.forEach(u=>i(y,u)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||p(w,r),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(w,y),y.raycast&&y.__r3f.eventCount&&Me(y).getState().internal.interaction.push(y),[v,v.alternate].forEach(u=>{u!==null&&(u.stateNode=y,u.ref&&(typeof u.ref=="function"?u.ref(y):u.ref.current=y))})}const c=()=>{};return{reconciler:En({createInstance:n,removeChild:p,appendChild:i,appendInitialChild:i,insertBefore:l,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const a=r.getState().scene;a.__r3f&&(a.__r3f.root=r,i(a,o))},removeChildFromContainer:(r,o)=>{o&&p(r.getState().scene,o)},insertInContainerBefore:(r,o,a)=>{if(!o||!a)return;const v=r.getState().scene;v.__r3f&&l(v,o,a)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,a,v){var h;if(((h=r==null?void 0:r.__r3f)!=null?h:{}).primitive&&v.object&&v.object!==r)return[!0];{const{args:y=[],children:u,...g}=v,{args:P=[],children:R,...M}=a;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((j,L)=>j!==P[L]))return[!0];const _=Ot(r,g,M,!0);return _.changes.length?[!1,_]:null}},commitUpdate(r,[o,a],v,h,w,y){o?f(r,v,w,y):Le(r,a)},commitMount(r,o,a,v){var h;const w=(h=r.__r3f)!=null?h:{};r.raycast&&w.handlers&&w.eventCount&&Me(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>ae(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:a,parent:v}=(o=r.__r3f)!=null?o:{};a&&v&&ct(v,r,a),r.isObject3D&&(r.visible=!1),le(r)},unhideInstance(r,o){var a;const{attach:v,parent:h}=(a=r.__r3f)!=null?a:{};v&&h&&Ae(h,r,v),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),le(r)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():ce.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Le}}var it,st;const Te=e=>"colorSpace"in e||"outputColorSpace"in e,_t=()=>{var e;return(e=Ze.ColorManagement)!=null?e:null},Pt=e=>e&&e.isOrthographicCamera,Tn=e=>e&&e.hasOwnProperty("current"),ge=typeof window<"u"&&((it=window.document)!=null&&it.createElement||((st=window.navigator)==null?void 0:st.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function Ct(e){const t=d.useRef(e);return ge(()=>void(t.current=e),[e]),t}function An({set:e}){return ge(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Mt extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Mt.getDerivedStateFromError=()=>({error:!0});const xt="__default",at=new Map,Ln=e=>e&&!!e.memoized&&!!e.changes;function St(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const pe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Me(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:l=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e)||z.boo(e))return e===t;const s=z.obj(e);if(s&&i==="reference")return e===t;const p=z.arr(e);if(p&&n==="reference")return e===t;if((p||s)&&e===t)return!0;let f;for(f in e)if(!(f in t))return!1;if(s&&n==="shallow"&&i==="shallow"){for(f in l?t:e)if(!z.equ(e[f],t[f],{strict:l,objects:"reference"}))return!1}else for(f in l?t:e)if(e[f]!==t[f])return!1;if(z.und(f)){if(p&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function kn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function Dn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ae(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ne(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),l=i.pop();return n=i.reduce((s,p)=>s[p],e),{target:n,key:l}}else return{target:n,key:t}}const lt=/-\d+$/;function Ae(e,t,n){if(z.str(n)){if(lt.test(n)){const s=n.replace(lt,""),{target:p,key:f}=Ne(e,s);Array.isArray(p[f])||(p[f]=[])}const{target:i,key:l}=Ne(e,n);t.__r3f.previousAttach=i[l],i[l]=t}else t.__r3f.previousAttach=n(e,t)}function ct(e,t,n){var i,l;if(z.str(n)){const{target:s,key:p}=Ne(e,n),f=t.__r3f.previousAttach;f===void 0?delete s[p]:s[p]=f}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(l=t.__r3f)==null||delete l.previousAttach}function Ot(e,{children:t,key:n,ref:i,...l},{children:s,key:p,ref:f,...c}={},m=!1){const r=e.__r3f,o=Object.entries(l),a=[];if(m){const h=Object.keys(c);for(let w=0;w<h.length;w++)l.hasOwnProperty(h[w])||o.unshift([h[w],xt+"remove"])}o.forEach(([h,w])=>{var y;if((y=e.__r3f)!=null&&y.primitive&&h==="object"||z.equ(w,c[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return a.push([h,w,!0,[]]);let u=[];h.includes("-")&&(u=h.split("-")),a.push([h,w,!1,u]);for(const g in l){const P=l[g];g.startsWith(`${h}-`)&&a.push([g,P,!1,g.split("-")])}});const v={...l};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(v.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(v.attach=r.memoizedProps.attach),{memoized:v,changes:a}}const zn=typeof process<"u"&&!1;function Le(e,t){var n;const i=e.__r3f,l=i==null?void 0:i.root,s=l==null||l.getState==null?void 0:l.getState(),{memoized:p,changes:f}=Ln(t)?t:Ot(e,t),c=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=p);for(let r=0;r<f.length;r++){let[o,a,v,h]=f[r];if(Te(e)){const g="srgb",P="srgb-linear";o==="encoding"?(o="colorSpace",a=a===3001?g:P):o==="outputEncoding"&&(o="outputColorSpace",a=a===3001?g:P)}let w=e,y=w[o];if(h.length&&(y=h.reduce((u,g)=>u[g],e),!(y&&y.set))){const[u,...g]=h.reverse();w=g.reverse().reduce((P,R)=>P[R],e),o=u}if(a===xt+"remove")if(w.constructor){let u=at.get(w.constructor);u||(u=new w.constructor,at.set(w.constructor,u)),a=u[o]}else a=0;if(v&&i)a?i.handlers[o]=a:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;else if(y&&y.set&&(y.copy||y instanceof Oe)){if(Array.isArray(a))y.fromArray?y.fromArray(a):y.set(...a);else if(y.copy&&a&&a.constructor&&(zn?y.constructor.name===a.constructor.name:y.constructor===a.constructor))y.copy(a);else if(a!==void 0){const u=y instanceof tn;!u&&y.setScalar?y.setScalar(a):y instanceof Oe&&a instanceof Oe?y.mask=a.mask:y.set(a),!_t()&&s&&!s.linear&&u&&y.convertSRGBToLinear()}}else if(w[o]=a,w[o]instanceof $e&&w[o].format===Xt&&w[o].type===Yt&&s){const u=w[o];Te(u)&&Te(s.gl)?u.colorSpace=s.gl.outputColorSpace:u.encoding=s.gl.outputEncoding}le(e)}if(i&&i.parent&&e.raycast&&c!==i.eventCount){const r=Me(e).getState().internal,o=r.interaction.indexOf(e);o>-1&&r.interaction.splice(o,1),i.eventCount&&r.interaction.push(e)}return!(f.length===1&&f[0][0]==="onUpdate")&&f.length&&(n=e.__r3f)!=null&&n.parent&&Ue(e),e}function le(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function Ue(e){e.onUpdate==null||e.onUpdate(e)}function Fn(e,t){e.manual||(Pt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function _e(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function In(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ce.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ce.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ce.ContinuousEventPriority;default:return ce.DefaultEventPriority}}function Rt(e,t,n,i){const l=n.get(t);l&&(n.delete(t),n.size===0&&(e.delete(i),l.target.releasePointerCapture(i)))}function Hn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,l)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(l)}),n.capturedMap.forEach((i,l)=>{Rt(n.capturedMap,t,i,l)})}function Wn(e){function t(c){const{internal:m}=e.getState(),r=c.offsetX-m.initialClick[0],o=c.offsetY-m.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(c){return c.filter(m=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=m.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(c,m){const r=e.getState(),o=new Set,a=[],v=m?m(r.internal.interaction):r.internal.interaction;for(let u=0;u<v.length;u++){const g=pe(v[u]);g&&(g.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(c,r);function h(u){const g=pe(u);if(!g||!g.events.enabled||g.raycaster.camera===null)return[];if(g.raycaster.camera===void 0){var P;g.events.compute==null||g.events.compute(c,g,(P=g.previousRoot)==null?void 0:P.getState()),g.raycaster.camera===void 0&&(g.raycaster.camera=null)}return g.raycaster.camera?g.raycaster.intersectObject(u,!0):[]}let w=v.flatMap(h).sort((u,g)=>{const P=pe(u.object),R=pe(g.object);return!P||!R?u.distance-g.distance:R.events.priority-P.events.priority||u.distance-g.distance}).filter(u=>{const g=_e(u);return o.has(g)?!1:(o.add(g),!0)});r.events.filter&&(w=r.events.filter(w,r));for(const u of w){let g=u.object;for(;g;){var y;(y=g.__r3f)!=null&&y.eventCount&&a.push({...u,eventObject:g}),g=g.parent}}if("pointerId"in c&&r.internal.capturedMap.has(c.pointerId))for(let u of r.internal.capturedMap.get(c.pointerId).values())o.has(_e(u.intersection))||a.push(u.intersection);return a}function l(c,m,r,o){const a=e.getState();if(c.length){const v={stopped:!1};for(const h of c){const w=pe(h.object)||a,{raycaster:y,pointer:u,camera:g,internal:P}=w,R=new q(u.x,u.y,0).unproject(g),M=T=>{var E,D;return(E=(D=P.capturedMap.get(T))==null?void 0:D.has(h.eventObject))!=null?E:!1},_=T=>{const E={intersection:h,target:m.target};P.capturedMap.has(T)?P.capturedMap.get(T).set(h.eventObject,E):P.capturedMap.set(T,new Map([[h.eventObject,E]])),m.target.setPointerCapture(T)},j=T=>{const E=P.capturedMap.get(T);E&&Rt(P.capturedMap,h.eventObject,E,T)};let L={};for(let T in m){let E=m[T];typeof E!="function"&&(L[T]=E)}let S={...h,...L,pointer:u,intersections:c,stopped:v.stopped,delta:r,unprojectedPoint:R,ray:y.ray,camera:g,stopPropagation(){const T="pointerId"in m&&P.capturedMap.get(m.pointerId);if((!T||T.has(h.eventObject))&&(S.stopped=v.stopped=!0,P.hovered.size&&Array.from(P.hovered.values()).find(E=>E.eventObject===h.eventObject))){const E=c.slice(0,c.indexOf(h));s([...E,h])}},target:{hasPointerCapture:M,setPointerCapture:_,releasePointerCapture:j},currentTarget:{hasPointerCapture:M,setPointerCapture:_,releasePointerCapture:j},nativeEvent:m};if(o(S),v.stopped===!0)break}}return c}function s(c){const{internal:m}=e.getState();for(const r of m.hovered.values())if(!c.length||!c.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const a=r.eventObject.__r3f,v=a==null?void 0:a.handlers;if(m.hovered.delete(_e(r)),a!=null&&a.eventCount){const h={...r,intersections:c};v.onPointerOut==null||v.onPointerOut(h),v.onPointerLeave==null||v.onPointerLeave(h)}}}function p(c,m){for(let r=0;r<m.length;r++){const o=m[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(c)}}function f(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return m=>{const{internal:r}=e.getState();"pointerId"in m&&r.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(m.pointerId)&&(r.capturedMap.delete(m.pointerId),s([]))})}}return function(r){const{onPointerMissed:o,internal:a}=e.getState();a.lastEvent.current=r;const v=c==="onPointerMove",h=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",y=i(r,v?n:void 0),u=h?t(r):0;c==="onPointerDown"&&(a.initialClick=[r.offsetX,r.offsetY],a.initialHits=y.map(P=>P.eventObject)),h&&!y.length&&u<=2&&(p(r,a.interaction),o&&o(r)),v&&s(y);function g(P){const R=P.eventObject,M=R.__r3f,_=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(v){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const j=_e(P),L=a.hovered.get(j);L?L.stopped&&P.stopPropagation():(a.hovered.set(j,P),_.onPointerOver==null||_.onPointerOver(P),_.onPointerEnter==null||_.onPointerEnter(P))}_.onPointerMove==null||_.onPointerMove(P)}else{const j=_[c];j?(!h||a.initialHits.includes(R))&&(p(r,a.interaction.filter(L=>!a.initialHits.includes(L))),j(P)):h&&a.initialHits.includes(R)&&p(r,a.interaction.filter(L=>!a.initialHits.includes(L)))}}l(y,r,u,g)}}return{handlePointer:f}}const jt=e=>!!(e!=null&&e.render),Tt=d.createContext(null),Bn=(e,t)=>{const n=bt((f,c)=>{const m=new q,r=new q,o=new q;function a(u=c().camera,g=r,P=c().size){const{width:R,height:M,top:_,left:j}=P,L=R/M;g instanceof q?o.copy(g):o.set(...g);const S=u.getWorldPosition(m).distanceTo(o);if(Pt(u))return{width:R/u.zoom,height:M/u.zoom,top:_,left:j,factor:1,distance:S,aspect:L};{const T=u.fov*Math.PI/180,E=2*Math.tan(T/2)*S,D=E*(R/M);return{width:D,height:E,top:_,left:j,factor:R/D,distance:S,aspect:L}}}let v;const h=u=>f(g=>({performance:{...g.performance,current:u}})),w=new gt;return{set:f,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(u=1)=>e(c(),u),advance:(u,g)=>t(u,g,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ln,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const u=c();v&&clearTimeout(v),u.performance.current!==u.performance.min&&h(u.performance.min),v=setTimeout(()=>h(c().performance.max),u.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:u=>f(g=>({...g,events:{...g.events,...u}})),setSize:(u,g,P,R,M)=>{const _=c().camera,j={width:u,height:g,top:R||0,left:M||0,updateStyle:P};f(L=>({size:j,viewport:{...L.viewport,...a(_,r,j)}}))},setDpr:u=>f(g=>{const P=St(u);return{viewport:{...g.viewport,dpr:P,initialDpr:g.viewport.initialDpr||P}}}),setFrameloop:(u="always")=>{const g=c().clock;g.stop(),g.elapsedTime=0,u!=="never"&&(g.start(),g.elapsedTime=0),f(()=>({frameloop:u}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(u,g,P)=>{const R=c().internal;return R.priority=R.priority+(g>0?1:0),R.subscribers.push({ref:u,priority:g,store:P}),R.subscribers=R.subscribers.sort((M,_)=>M.priority-_.priority),()=>{const M=c().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(g>0?1:0),M.subscribers=M.subscribers.filter(_=>_.ref!==u))}}}}}),i=n.getState();let l=i.size,s=i.viewport.dpr,p=i.camera;return n.subscribe(()=>{const{camera:f,size:c,viewport:m,gl:r,set:o}=n.getState();if(c.width!==l.width||c.height!==l.height||m.dpr!==s){var a;l=c,s=m.dpr,Fn(f,c),r.setPixelRatio(m.dpr);const v=(a=c.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(c.width,c.height,v)}f!==p&&(p=f,o(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(f)}})))}),n.subscribe(f=>e(f)),n};let Pe,$n=new Set,Nn=new Set,Un=new Set;function ke(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function me(e,t){switch(e){case"before":return ke($n,t);case"after":return ke(Nn,t);case"tail":return ke(Un,t)}}let De,ze;function Fe(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,Pe=0;Pe<De.length;Pe++)ze=De[Pe],ze.ref.current(ze.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Gn(e){let t=!1,n=!1,i,l,s;function p(m){l=requestAnimationFrame(p),t=!0,i=0,me("before",m),n=!0;for(const o of e.values()){var r;s=o.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((r=s.gl.xr)!=null&&r.isPresenting)&&(i+=Fe(m,s))}if(n=!1,me("after",m),i===0)return me("tail",m),t=!1,cancelAnimationFrame(l)}function f(m,r=1){var o;if(!m)return e.forEach(a=>f(a.store.getState(),r));(o=m.gl.xr)!=null&&o.isPresenting||!m.internal.active||m.frameloop==="never"||(r>1?m.internal.frames=Math.min(60,m.internal.frames+r):n?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(p)))}function c(m,r=!0,o,a){if(r&&me("before",m),o)Fe(m,o,a);else for(const v of e.values())Fe(m,v.store.getState());r&&me("after",m)}return{loop:p,invalidate:f,advance:c}}function At(){const e=d.useContext(Tt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function G(e=n=>n,t){return At()(e,t)}function ye(e,t=0){const n=At(),i=n.getState().internal.subscribe,l=Ct(e);return ge(()=>i(l,t,n),[t,i,n]),null}const ut=new WeakMap;function Lt(e,t){return function(n,...i){let l=ut.get(n);return l||(l=new n,ut.set(n,l)),e&&e(l),Promise.all(i.map(s=>new Promise((p,f)=>l.load(s,c=>{c.scene&&Object.assign(c,kn(c.scene)),p(c)},t,c=>f(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function Q(e,t,n,i){const l=Array.isArray(t)?t:[t],s=xn(Lt(n,i),[e,...l],{equal:z.equ});return Array.isArray(t)?s:s[0]}Q.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return Sn(Lt(n),[e,...i])};Q.clear=function(e,t){const n=Array.isArray(t)?t:[t];return On([e,...n])};const fe=new Map,{invalidate:ft,advance:dt}=Gn(fe),{reconciler:xe,applyProps:Z}=jn(fe,In),se={objects:"shallow",strict:!1},qn=(e,t)=>{const n=typeof e=="function"?e(t):e;return jt(n)?n:new nn({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Vn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:l,top:s,left:p,updateStyle:f=n}=t;return{width:i,height:l,top:s,left:p,updateStyle:f}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:l,top:s,left:p}=e.parentElement.getBoundingClientRect();return{width:i,height:l,top:s,left:p,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Xn(e){const t=fe.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const l=typeof reportError=="function"?reportError:console.error,s=i||Bn(ft,dt),p=n||xe.createContainer(s,ce.ConcurrentRoot,null,!1,null,"",l,null);t||fe.set(e,{fiber:p,store:s});let f,c=!1,m;return{configure(r={}){let{gl:o,size:a,scene:v,events:h,onCreated:w,shadows:y=!1,linear:u=!1,flat:g=!1,legacy:P=!1,orthographic:R=!1,frameloop:M="always",dpr:_=[1,2],performance:j,raycaster:L,camera:S,onPointerMissed:T}=r,E=s.getState(),D=E.gl;E.gl||E.set({gl:D=qn(o,e)});let W=E.raycaster;W||E.set({raycaster:W=new Zt});const{params:X,...I}=L||{};if(z.equ(I,W,se)||Z(W,{...I}),z.equ(X,W.params,se)||Z(W,{params:{...W.params,...X}}),!E.camera||E.camera===m&&!z.equ(m,S,se)){m=S;const C=S instanceof rn,O=C?S:R?new qe(0,0,0,0,.1,1e3):new Ve(75,0,.1,1e3);C||(O.position.z=5,S&&(Z(O,S),("aspect"in S||"left"in S||"right"in S||"bottom"in S||"top"in S)&&(O.manual=!0,O.updateProjectionMatrix())),!E.camera&&!(S!=null&&S.rotation)&&O.lookAt(0,0,0)),E.set({camera:O}),W.camera=O}if(!E.scene){let C;v instanceof nt?C=v:(C=new nt,v&&Z(C,v)),E.set({scene:ae(C)})}if(!E.xr){var $;const C=(A,B)=>{const N=s.getState();N.frameloop!=="never"&&dt(A,!0,N,B)},O=()=>{const A=s.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?C:null),A.gl.xr.isPresenting||ft(A)},k={connect(){const A=s.getState().gl;A.xr.addEventListener("sessionstart",O),A.xr.addEventListener("sessionend",O)},disconnect(){const A=s.getState().gl;A.xr.removeEventListener("sessionstart",O),A.xr.removeEventListener("sessionend",O)}};typeof(($=D.xr)==null?void 0:$.addEventListener)=="function"&&k.connect(),E.set({xr:k})}if(D.shadowMap){const C=D.shadowMap.enabled,O=D.shadowMap.type;if(D.shadowMap.enabled=!!y,z.boo(y))D.shadowMap.type=Re;else if(z.str(y)){var H;const k={basic:on,percentage:sn,soft:Re,variance:an};D.shadowMap.type=(H=k[y])!=null?H:Re}else z.obj(y)&&Object.assign(D.shadowMap,y);(C!==D.shadowMap.enabled||O!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}const b=_t();b&&("enabled"in b?b.enabled=!P:"legacyMode"in b&&(b.legacyMode=P)),c||Z(D,{outputEncoding:u?3e3:3001,toneMapping:g?Kt:Jt}),E.legacy!==P&&E.set(()=>({legacy:P})),E.linear!==u&&E.set(()=>({linear:u})),E.flat!==g&&E.set(()=>({flat:g})),o&&!z.fun(o)&&!jt(o)&&!z.equ(o,D,se)&&Z(D,o),h&&!E.events.handlers&&E.set({events:h(s)});const x=Vn(e,a);return z.equ(x,E.size,se)||E.setSize(x.width,x.height,x.updateStyle,x.top,x.left),_&&E.viewport.dpr!==St(_)&&E.setDpr(_),E.frameloop!==M&&E.setFrameloop(M),E.onPointerMissed||E.set({onPointerMissed:T}),j&&!z.equ(j,E.performance,se)&&E.set(C=>({performance:{...C.performance,...j}})),f=w,c=!0,this},render(r){return c||this.configure(),xe.updateContainer(V.jsx(Yn,{store:s,children:r,onCreated:f,rootElement:e}),p,null,()=>{}),s},unmount(){kt(e)}}}function Yn({store:e,children:t,onCreated:n,rootElement:i}){return ge(()=>{const l=e.getState();l.set(s=>({internal:{...s.internal,active:!0}})),n&&n(l),e.getState().events.connected||l.events.connect==null||l.events.connect(i)},[]),V.jsx(Tt.Provider,{value:e,children:t})}function kt(e,t){const n=fe.get(e),i=n==null?void 0:n.fiber;if(i){const l=n==null?void 0:n.store.getState();l&&(l.internal.active=!1),xe.updateContainer(null,i,null,()=>{l&&setTimeout(()=>{try{var s,p,f,c;l.events.disconnect==null||l.events.disconnect(),(s=l.gl)==null||(p=s.renderLists)==null||p.dispose==null||p.dispose(),(f=l.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(c=l.gl)!=null&&c.xr&&l.xr.disconnect(),Dn(l),fe.delete(e)}catch{}},500)})}}xe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const Ie={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Zn(e){const{handlePointer:t}=Wn(e);return{priority:1,enabled:!0,compute(n,i,l){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Ie).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:l}=e.getState();(n=l.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(l.lastEvent.current)},connect:n=>{var i;const{set:l,events:s}=e.getState();s.disconnect==null||s.disconnect(),l(p=>({events:{...p.events,connected:n}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([p,f])=>{const[c,m]=Ie[p];n.addEventListener(c,f,{passive:m})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var l;Object.entries((l=i.handlers)!=null?l:[]).forEach(([s,p])=>{if(i&&i.connected instanceof HTMLElement){const[f]=Ie[s];i.connected.removeEventListener(f,p)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}function Kn({debounce:e,scroll:t,polyfill:n,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const l=n||typeof window<"u"&&window.ResizeObserver,[s,p]=d.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!l)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const f=d.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,r=d.useRef(!1);d.useEffect(()=>(r.current=!0,()=>void(r.current=!1)));const[o,a,v]=d.useMemo(()=>{const u=()=>{if(!f.current.element)return;const{left:g,top:P,width:R,height:M,bottom:_,right:j,x:L,y:S}=f.current.element.getBoundingClientRect(),T={left:g,top:P,width:R,height:M,bottom:_,right:j,x:L,y:S};f.current.element instanceof HTMLElement&&i&&(T.height=f.current.element.offsetHeight,T.width=f.current.element.offsetWidth),Object.freeze(T),r.current&&!tr(f.current.lastBounds,T)&&p(f.current.lastBounds=T)};return[u,m?rt(u,m):u,c?rt(u,c):u]},[p,i,c,m]);function h(){f.current.scrollContainers&&(f.current.scrollContainers.forEach(u=>u.removeEventListener("scroll",v,!0)),f.current.scrollContainers=null),f.current.resizeObserver&&(f.current.resizeObserver.disconnect(),f.current.resizeObserver=null),f.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",f.current.orientationHandler))}function w(){var u;f.current.element&&(f.current.resizeObserver=new l(a),(u=f.current.resizeObserver)==null||u.observe(f.current.element),t&&f.current.scrollContainers&&f.current.scrollContainers.forEach(g=>g.addEventListener("scroll",v,{capture:!0,passive:!0})),f.current.orientationHandler=()=>{v()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",f.current.orientationHandler))}const y=u=>{!u||u===f.current.element||(h(),f.current.element=u,f.current.scrollContainers=Dt(u),w())};return Qn(v,!!t),Jn(a),d.useEffect(()=>{h(),w()},[t,v,a]),d.useEffect(()=>h,[]),[y,s,o]}function Jn(e){d.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Qn(e,t){d.useEffect(()=>{if(t){const n=e;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[e,t])}function Dt(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:i,overflowY:l}=window.getComputedStyle(e);return[n,i,l].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...Dt(e.parentElement)]}const er=["x","y","top","bottom","left","right","width","height"],tr=(e,t)=>er.every(n=>e[n]===t[n]),nr=d.forwardRef(function({children:t,fallback:n,resize:i,style:l,gl:s,events:p=Zn,eventSource:f,eventPrefix:c,shadows:m,linear:r,flat:o,legacy:a,orthographic:v,frameloop:h,dpr:w,performance:y,raycaster:u,camera:g,scene:P,onPointerMissed:R,onCreated:M,..._},j){d.useMemo(()=>Rn(cn),[]);const L=wn(),[S,T]=Kn({scroll:!0,debounce:{scroll:50,resize:0},...i}),E=d.useRef(null),D=d.useRef(null);d.useImperativeHandle(j,()=>E.current);const W=Ct(R),[X,I]=d.useState(!1),[$,H]=d.useState(!1);if(X)throw X;if($)throw $;const b=d.useRef(null);ge(()=>{const C=E.current;T.width>0&&T.height>0&&C&&(b.current||(b.current=Xn(C)),b.current.configure({gl:s,events:p,shadows:m,linear:r,flat:o,legacy:a,orthographic:v,frameloop:h,dpr:w,performance:y,raycaster:u,camera:g,scene:P,size:T,onPointerMissed:(...O)=>W.current==null?void 0:W.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(f?Tn(f)?f.current:f:D.current),c&&O.setEvents({compute:(k,A)=>{const B=k[c+"X"],N=k[c+"Y"];A.pointer.set(B/A.size.width*2-1,-(N/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),M==null||M(O)}}),b.current.render(V.jsx(L,{children:V.jsx(Mt,{set:H,children:V.jsx(d.Suspense,{fallback:V.jsx(An,{set:I}),children:t})})})))}),d.useEffect(()=>{const C=E.current;if(C)return()=>kt(C)},[]);const x=f?"none":"auto";return V.jsx("div",{ref:D,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...l},..._,children:V.jsx("div",{ref:S,style:{width:"100%",height:"100%"},children:V.jsx("canvas",{ref:E,style:{display:"block"},children:n})})})}),Lr=d.forwardRef(function(t,n){return V.jsx(bn,{children:V.jsx(nr,{...t,ref:n})})}),be=new q,Ke=new q,rr=new q,pt=new gt;function or(e,t,n){const i=be.setFromMatrixPosition(e.matrixWorld);i.project(t);const l=n.width/2,s=n.height/2;return[i.x*l+l,-(i.y*s)+s]}function ir(e,t){const n=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),l=n.sub(i),s=t.getWorldDirection(rr);return l.angleTo(s)>Math.PI/2}function sr(e,t,n,i){const l=be.setFromMatrixPosition(e.matrixWorld),s=l.clone();s.project(t),pt.set(s.x,s.y),n.setFromCamera(pt,t);const p=n.intersectObjects(i,!0);if(p.length){const f=p[0].distance;return l.distanceTo(n.ray.origin)<f}return!0}function ar(e,t){if(t instanceof qe)return t.zoom;if(t instanceof Ve){const n=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),l=t.fov*Math.PI/180,s=n.distanceTo(i);return 1/(2*Math.tan(l/2)*s)}else return 1}function lr(e,t,n){if(t instanceof Ve||t instanceof qe){const i=be.setFromMatrixPosition(e.matrixWorld),l=Ke.setFromMatrixPosition(t.matrixWorld),s=i.distanceTo(l),p=(n[1]-n[0])/(t.far-t.near),f=n[1]-p*t.far;return Math.round(p*s+f)}}const Ge=e=>Math.abs(e)<1e-10?0:e;function zt(e,t,n=""){let i="matrix3d(";for(let l=0;l!==16;l++)i+=Ge(t[l]*e.elements[l])+(l!==15?",":")");return n+i}const cr=(e=>t=>zt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),ur=(e=>(t,n)=>zt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function fr(e){return e&&typeof e=="object"&&"current"in e}const kr=d.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:l,center:s,fullscreen:p,portal:f,distanceFactor:c,sprite:m=!1,transform:r=!1,occlude:o,onOcclude:a,castShadow:v,receiveShadow:h,material:w,geometry:y,zIndexRange:u=[16777271,0],calculatePosition:g=or,as:P="div",wrapperClass:R,pointerEvents:M="auto",..._},j)=>{const{gl:L,camera:S,scene:T,size:E,raycaster:D,events:W,viewport:X}=G(),[I]=d.useState(()=>document.createElement(P)),$=d.useRef(),H=d.useRef(null),b=d.useRef(0),x=d.useRef([0,0]),C=d.useRef(null),O=d.useRef(null),k=(f==null?void 0:f.current)||W.connected||L.domElement.parentNode,A=d.useRef(null),B=d.useRef(!1),N=d.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&fr(o[0]),[o]);d.useLayoutEffect(()=>{const U=L.domElement;o&&o==="blending"?(U.style.zIndex=`${Math.floor(u[0]/2)}`,U.style.position="absolute",U.style.pointerEvents="none"):(U.style.zIndex=null,U.style.position=null,U.style.pointerEvents=null)},[o]),d.useLayoutEffect(()=>{if(H.current){const U=$.current=_n(I);if(T.updateMatrixWorld(),r)I.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const F=g(H.current,S,E);I.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${F[0]}px,${F[1]}px,0);transform-origin:0 0;`}return k&&(l?k.prepend(I):k.appendChild(I)),()=>{k&&k.removeChild(I),U.unmount()}}},[k,r]),d.useLayoutEffect(()=>{R&&(I.className=R)},[R]);const Y=d.useMemo(()=>r?{position:"absolute",top:0,left:0,width:E.width,height:E.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...p&&{top:-E.height/2,left:-E.width/2,width:E.width,height:E.height},...n},[n,s,p,E,r]),oe=d.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);d.useLayoutEffect(()=>{if(B.current=!1,r){var U;(U=$.current)==null||U.render(d.createElement("div",{ref:C,style:Y},d.createElement("div",{ref:O,style:oe},d.createElement("div",{ref:j,className:i,style:n,children:e}))))}else{var F;(F=$.current)==null||F.render(d.createElement("div",{ref:j,style:Y,className:i,children:e}))}});const ie=d.useRef(!0);ye(U=>{if(H.current){S.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const F=r?x.current:g(H.current,S,E);if(r||Math.abs(b.current-S.zoom)>t||Math.abs(x.current[0]-F[0])>t||Math.abs(x.current[1]-F[1])>t){const ee=ir(H.current,S);let K=!1;N&&(Array.isArray(o)?K=o.map(te=>te.current):o!=="blending"&&(K=[T]));const de=ie.current;if(K){const te=sr(H.current,S,D,K);ie.current=te&&!ee}else ie.current=!ee;de!==ie.current&&(a?a(!ie.current):I.style.display=ie.current?"block":"none");const we=Math.floor(u[0]/2),Bt=o?N?[u[0],we]:[we-1,0]:u;if(I.style.zIndex=`${lr(H.current,S,Bt)}`,r){const[te,et]=[E.width/2,E.height/2],Se=S.projectionMatrix.elements[5]*et,{isOrthographicCamera:tt,top:$t,left:Nt,bottom:Ut,right:Gt}=S,qt=cr(S.matrixWorldInverse),Vt=tt?`scale(${Se})translate(${Ge(-(Gt+Nt)/2)}px,${Ge(($t+Ut)/2)}px)`:`translateZ(${Se}px)`;let ne=H.current.matrixWorld;m&&(ne=S.matrixWorldInverse.clone().transpose().copyPosition(ne).scale(H.current.scale),ne.elements[3]=ne.elements[7]=ne.elements[11]=0,ne.elements[15]=1),I.style.width=E.width+"px",I.style.height=E.height+"px",I.style.perspective=tt?"":`${Se}px`,C.current&&O.current&&(C.current.style.transform=`${Vt}${qt}translate(${te}px,${et}px)`,O.current.style.transform=ur(ne,1/((c||10)/400)))}else{const te=c===void 0?1:ar(H.current,S)*c;I.style.transform=`translate3d(${F[0]}px,${F[1]}px,0) scale(${te})`}x.current=F,b.current=S.zoom}}if(!N&&A.current&&!B.current)if(r){if(C.current){const F=C.current.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const{isOrthographicCamera:ee}=S;if(ee||y)_.scale&&(Array.isArray(_.scale)?_.scale instanceof q?A.current.scale.copy(_.scale.clone().divideScalar(1)):A.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):A.current.scale.setScalar(1/_.scale));else{const K=(c||10)/400,de=F.clientWidth*K,we=F.clientHeight*K;A.current.scale.set(de,we,1)}B.current=!0}}}else{const F=I.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const ee=1/X.factor,K=F.clientWidth*ee,de=F.clientHeight*ee;A.current.scale.set(K,de,1),B.current=!0}A.current.lookAt(U.camera.position)}});const Qe=d.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return d.createElement("group",J({},_,{ref:H}),o&&!N&&d.createElement("mesh",{castShadow:v,receiveShadow:h,ref:A},y||d.createElement("planeGeometry",null),w||d.createElement("shaderMaterial",{side:un,vertexShader:Qe.vertexShader,fragmentShader:Qe.fragmentShader})))});let ve=0;const Dr=bt(e=>(Ee.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-ve)/(i-ve)*100})},Ee.onLoad=()=>{e({active:!1})},Ee.onError=t=>e(n=>({errors:[...n.errors,t]})),Ee.onProgress=(t,n,i)=>{n===i&&(ve=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-ve)/(i-ve)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),He=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Ft(e,t){const n=G(s=>s.gl),i=Q(Xe,He(e)?Object.values(e):e);return d.useLayoutEffect(()=>{t==null||t(i)},[t]),d.useEffect(()=>{if("initTexture"in n){let s=[];Array.isArray(i)?s=i:i instanceof $e?s=[i]:He(i)&&(s=Object.values(i)),s.forEach(p=>{p instanceof $e&&n.initTexture(p)})}},[n,i]),d.useMemo(()=>{if(He(e)){const s={};let p=0;for(const f in e)s[f]=i[p++];return s}else return i},[e,i])}Ft.preload=e=>Q.preload(Xe,e);Ft.clear=e=>Q.clear(Xe,e);const dr=()=>parseInt(fn.replace(/\D+/g,"")),It=dr();function pr(e){return Array.isArray(e)}function We(e=[0,0,0]){return pr(e)?e:e instanceof q||e instanceof yt?[e.x,e.y,e.z]:[e,e,e]}const zr=d.forwardRef(function({debug:t,depthTest:n=!1,polygonOffsetFactor:i=-10,map:l,mesh:s,children:p,position:f,rotation:c,scale:m,...r},o){const a=d.useRef(null);d.useImperativeHandle(o,()=>a.current);const v=d.useRef(null);return d.useLayoutEffect(()=>{const h=(s==null?void 0:s.current)||a.current.parent,w=a.current;if(!(h instanceof dn))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const y={position:new q,rotation:new yt,scale:new q(1,1,1)};if(h){Z(y,{position:f,scale:m});const u=h.matrixWorld.clone();if(h.matrixWorld.identity(),!c||typeof c=="number"){const g=new pn;g.position.copy(y.position),g.lookAt(h.position),typeof c=="number"&&g.rotateZ(c),Z(y,{rotation:g.rotation})}else Z(y,{rotation:c});return w.geometry=new Pn(h,y.position,y.rotation,y.scale),v.current&&(Z(v.current,y),v.current.traverse(g=>g.raycast=()=>null)),h.matrixWorld=u,()=>{w.geometry.dispose()}}},[s,...We(f),...We(m),...We(c)]),d.createElement("mesh",J({ref:a,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":n,"material-map":l},r),p,t&&d.createElement("mesh",{ref:v},d.createElement("boxGeometry",null),d.createElement("meshNormalMaterial",{wireframe:!0}),d.createElement("axesHelper",null)))});let Ce=null,Ht="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Wt(e=!0,t=!0,n){return i=>{n&&n(i),e&&(Ce||(Ce=new Cn),Ce.setDecoderPath(typeof e=="string"?e:Ht),i.setDRACOLoader(Ce)),t&&i.setMeshoptDecoder(typeof je=="function"?je():je)}}const Je=(e,t,n,i)=>Q(Ye,e,Wt(t,n,i));Je.preload=(e,t,n,i)=>Q.preload(Ye,e,Wt(t,n,i));Je.clear=e=>Q.clear(Ye,e);Je.setDecoderPath=e=>{Ht=e};const Fr=d.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:l=!0,keyEvents:s=!1,onChange:p,onStart:f,onEnd:c,...m},r)=>{const o=G(_=>_.invalidate),a=G(_=>_.camera),v=G(_=>_.gl),h=G(_=>_.events),w=G(_=>_.setEvents),y=G(_=>_.set),u=G(_=>_.get),g=G(_=>_.performance),P=t||a,R=i||h.connected||v.domElement,M=d.useMemo(()=>new Mn(P),[P]);return ye(()=>{M.enabled&&M.update()},-1),d.useEffect(()=>(s&&M.connect(s===!0?R:s),M.connect(R),()=>void M.dispose()),[s,R,n,M,o]),d.useEffect(()=>{const _=S=>{o(),n&&g.regress(),p&&p(S)},j=S=>{f&&f(S)},L=S=>{c&&c(S)};return M.addEventListener("change",_),M.addEventListener("start",j),M.addEventListener("end",L),()=>{M.removeEventListener("start",j),M.removeEventListener("end",L),M.removeEventListener("change",_)}},[p,f,c,M,o,w]),d.useEffect(()=>{if(e){const _=u().controls;return y({controls:M}),()=>y({controls:_})}},[e,M]),d.createElement("primitive",J({ref:r,object:M,enableDamping:l},m))}),mr="modulepreload",vr=function(e){return"/"+e},mt={},Ir=function(t,n,i){let l=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),f=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));l=Promise.allSettled(n.map(c=>{if(c=vr(c),c in mt)return;mt[c]=!0;const m=c.endsWith(".css"),r=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${r}`))return;const o=document.createElement("link");if(o.rel=m?"stylesheet":mr,m||(o.as="script"),o.crossOrigin="",o.href=c,f&&o.setAttribute("nonce",f),document.head.appendChild(o),m)return new Promise((a,v)=>{o.addEventListener("load",a),o.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(p){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=p,window.dispatchEvent(f),!f.defaultPrevented)throw p}return l.then(p=>{for(const f of p||[])f.status==="rejected"&&s(f.reason);return t().catch(s)})},Be=It>=154?"opaque_fragment":"output_fragment";class hr extends mn{constructor(t){super(t),this.onBeforeCompile=(n,i)=>{const{isWebGL2:l}=i.capabilities;n.fragmentShader=n.fragmentShader.replace(`#include <${Be}>`,`
        ${l?`#include <${Be}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Be}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${It>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Hr=d.forwardRef((e,t)=>{const[n]=d.useState(()=>new hr(null));return d.createElement("primitive",J({},e,{object:n,ref:t,attach:"material"}))}),Wr=d.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:i=1,floatIntensity:l=1,floatingRange:s=[-.1,.1],autoInvalidate:p=!1,...f},c)=>{const m=d.useRef(null);d.useImperativeHandle(c,()=>m.current,[]);const r=d.useRef(Math.random()*1e4);return ye(o=>{var a,v;if(!t||n===0)return;p&&o.invalidate();const h=r.current+o.clock.getElapsedTime();m.current.rotation.x=Math.cos(h/4*n)/8*i,m.current.rotation.y=Math.sin(h/4*n)/8*i,m.current.rotation.z=Math.sin(h/4*n)/20*i;let w=Math.sin(h/4*n)/10;w=vn.mapLinear(w,-.1,.1,(a=s==null?void 0:s[0])!==null&&a!==void 0?a:-.1,(v=s==null?void 0:s[1])!==null&&v!==void 0?v:.1),m.current.position.y=w*l,m.current.updateMatrix()}),d.createElement("group",f,d.createElement("group",{ref:m,matrixAutoUpdate:!1},e))});let re,he;const gr=d.createContext(null),vt=new hn,ht=new q,yr=d.forwardRef(({children:e,range:t,limit:n=1e3,...i},l)=>{const s=d.useRef(null);d.useImperativeHandle(l,()=>s.current,[]);const[p,f]=d.useState([]),[[c,m,r]]=d.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);d.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),ye(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),vt.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,p.length),re=0;re<p.length;re++)he=p[re].current,he.getWorldPosition(ht).applyMatrix4(vt),ht.toArray(c,re*3),s.current.geometry.attributes.position.needsUpdate=!0,he.matrixWorldNeedsUpdate=!0,he.color.toArray(m,re*3),s.current.geometry.attributes.color.needsUpdate=!0,r.set([he.size],re),s.current.geometry.attributes.size.needsUpdate=!0});const o=d.useMemo(()=>({getParent:()=>s,subscribe:a=>(f(v=>[...v,a]),()=>f(v=>v.filter(h=>h.current!==a.current)))}),[]);return d.createElement("points",J({userData:{instances:p},matrixAutoUpdate:!1,ref:s,raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ue}),d.createElement("bufferAttribute",{attach:"attributes-color",count:m.length/3,array:m,itemSize:3,usage:ue}),d.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:ue})),d.createElement(gr.Provider,{value:o},e))}),br=d.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:l=3,...s},p)=>{const f=d.useRef(null);return d.useImperativeHandle(p,()=>f.current,[]),ye(()=>{const c=f.current.geometry.attributes;c.position.needsUpdate=!0,n&&(c.color.needsUpdate=!0),i&&(c.size.needsUpdate=!0)}),d.createElement("points",J({ref:f},s),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/l,array:t,itemSize:l,usage:ue}),n&&d.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/l,array:n,itemSize:3,usage:ue}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/l,array:i,itemSize:1,usage:ue})),e)}),Br=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(br,J({},e,{ref:t})):d.createElement(yr,J({},e,{ref:t})));function $r({all:e,scene:t,camera:n}){const i=G(({gl:p})=>p),l=G(({camera:p})=>p),s=G(({scene:p})=>p);return d.useLayoutEffect(()=>{const p=[];e&&(t||s).traverse(m=>{m.visible===!1&&(p.push(m),m.visible=!0)}),i.compile(t||s,n||l);const f=new gn(128);new yn(.01,1e5,f).update(i,t||s),f.dispose(),p.forEach(m=>m.visible=!1)},[]),null}export{Lr as C,zr as D,Wr as F,kr as H,Fr as O,$r as P,Ir as _,Ar as a,Je as b,Ft as c,ye as d,Br as e,Hr as f,Tr as g,Dr as u};
